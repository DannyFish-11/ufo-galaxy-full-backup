<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - æ˜Ÿç³»æ™ºèƒ½ä½“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Rajdhani', sans-serif; }
        body { background: #000000; overflow: hidden; }
        
        .galaxy-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, #0a0a20 0%, #000000 70%),
                        radial-gradient(circle at 20% 80%, rgba(120, 0, 255, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 150, 255, 0.15) 0%, transparent 50%);
            z-index: -2;
        }
        
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--duration) ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: var(--opacity); } 50% { opacity: 0.2; } }
        
        .galaxy-title {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #00d4ff, #7b2fff, #ff006e, #00d4ff);
            background-size: 300% 300%;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: gradient-shift 5s ease infinite;
        }
        @keyframes gradient-shift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        
        .status-card { background: rgba(10, 10, 30, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .galaxy-input { background: rgba(10, 10, 30, 0.8); border: 1px solid rgba(0, 212, 255, 0.3); transition: all 0.3s ease; }
        .galaxy-input:focus { border-color: rgba(0, 212, 255, 0.6); box-shadow: 0 0 20px rgba(0, 212, 255, 0.2); }
        
        .tab-active { background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(123, 47, 255, 0.2)); border-bottom: 2px solid #00d4ff; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #00d4ff, #7b2fff); border-radius: 3px; }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="galaxy-bg"></div>
    <div class="stars" ref="starsContainer"></div>
    
    <div id="app" class="h-screen flex flex-col relative z-10">
        
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="px-6 py-4 border-b border-white/10 bg-black/30 backdrop-blur-md">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-purple-600 flex items-center justify-center">
                            <span class="text-lg font-bold">G</span>
                        </div>
                        <h1 class="galaxy-title text-2xl font-bold tracking-wider">GALAXY</h1>
                    </div>
                    <span class="text-xs text-gray-500 font-mono">v2.3.24</span>
                </div>
                
                <!-- æ ‡ç­¾é¡µ -->
                <div class="flex space-x-1">
                    <button @click="currentTab = 'chat'" 
                            :class="currentTab === 'chat' ? 'tab-active' : ''"
                            class="px-4 py-2 text-sm rounded-t-lg transition-all hover:bg-white/5">
                        ğŸ’¬ å¯¹è¯
                    </button>
                    <button @click="currentTab = 'config'" 
                            :class="currentTab === 'config' ? 'tab-active' : ''"
                            class="px-4 py-2 text-sm rounded-t-lg transition-all hover:bg-white/5">
                        âš™ï¸ é…ç½®
                    </button>
                    <button @click="currentTab = 'nodes'" 
                            :class="currentTab === 'nodes' ? 'tab-active' : ''"
                            class="px-4 py-2 text-sm rounded-t-lg transition-all hover:bg-white/5">
                        ğŸŒ èŠ‚ç‚¹
                    </button>
                </div>
                
                <div class="flex items-center space-x-4 text-sm">
                    <span class="text-gray-600 font-mono">{{ currentTime }}</span>
                </div>
            </div>
        </header>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 overflow-hidden">
            
            <!-- å¯¹è¯é¡µé¢ -->
            <div v-show="currentTab === 'chat'" class="h-full flex flex-col">
                <div class="flex-1 overflow-auto p-6 space-y-4" ref="chatContainer">
                    <div v-if="messages.length === 0" class="text-center py-20">
                        <div class="galaxy-title text-4xl font-bold mb-4">GALAXY</div>
                        <div class="text-gray-500 text-lg mb-2">L4 çº§è‡ªä¸»æ€§æ™ºèƒ½ç³»ç»Ÿ</div>
                        <div class="text-gray-600 text-sm">è¯·å…ˆåœ¨ã€Œé…ç½®ã€é¡µé¢é…ç½® API Key</div>
                    </div>
                    
                    <div v-for="msg in messages" :key="msg.id" 
                         class="flex" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'">
                        <div class="max-w-2xl rounded-2xl p-4"
                             :class="msg.role === 'user' ? 'bg-cyan-900/30 border border-cyan-500/30' : 'bg-purple-900/30 border border-purple-500/30'">
                            <div class="whitespace-pre-wrap text-sm leading-relaxed">{{ msg.content }}</div>
                            <div class="text-xs mt-2 opacity-50 font-mono">{{ formatTime(msg.timestamp) }}</div>
                        </div>
                    </div>
                    
                    <div v-if="isLoading" class="flex justify-start">
                        <div class="bg-purple-900/30 rounded-2xl p-4">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 bg-cyan-400 rounded-full animate-bounce"></div>
                                <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 border-t border-white/10 bg-black/30 backdrop-blur-md">
                    <div class="flex space-x-3">
                        <input v-model="inputMessage" @keypress.enter="sendMessage" type="text"
                               placeholder="è¾“å…¥æ¶ˆæ¯..." class="galaxy-input flex-1 rounded-xl px-4 py-3 text-white outline-none">
                        <button @click="sendMessage" class="px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-cyan-500 to-purple-600">
                            å‘é€
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- é…ç½®é¡µé¢ -->
            <div v-show="currentTab === 'config'" class="h-full overflow-auto p-6">
                <div class="max-w-4xl mx-auto space-y-6">
                    
                    <!-- çŠ¶æ€å¡ç‰‡ -->
                    <div class="status-card rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3">ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                        <div class="grid grid-cols-4 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-cyan-400">{{ configStatus.total_models || 0 }}</div>
                                <div class="text-xs text-gray-500">æ€»æ¨¡å‹</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-400">{{ configStatus.configured_models || 0 }}</div>
                                <div class="text-xs text-gray-500">å·²é…ç½®</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-purple-400">{{ configStatus.total_nodes || 0 }}</div>
                                <div class="text-xs text-gray-500">èŠ‚ç‚¹æ•°</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold" :class="configStatus.oneapi_configured ? 'text-green-400' : 'text-red-400'">
                                    {{ configStatus.oneapi_configured ? 'âœ“' : 'âœ—' }}
                                </div>
                                <div class="text-xs text-gray-500">OneAPI</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- OneAPI é…ç½® -->
                    <div class="status-card rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3">ğŸ”— OneAPI èšåˆå™¨ (æ ¸å¿ƒ)</h3>
                        <p class="text-xs text-gray-500 mb-4">OneAPI æ˜¯æ¨¡å‹èšåˆå™¨ï¼Œæ”¯æŒå¤šç§ LLM æä¾›å•†</p>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="text-xs text-gray-400">Base URL</label>
                                <input v-model="oneapiUrl" type="text" placeholder="http://localhost:8001/v1"
                                       class="galaxy-input w-full rounded-lg px-3 py-2 text-sm outline-none">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">API Key</label>
                                <input v-model="oneapiKey" type="password" placeholder="sk-..."
                                       class="galaxy-input w-full rounded-lg px-3 py-2 text-sm outline-none">
                            </div>
                            <button @click="saveOneAPI" class="px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-sm">
                                ä¿å­˜ OneAPI é…ç½®
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç›´æ¥æ¨¡å‹é…ç½® -->
                    <div class="status-card rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3">ğŸ¤– ç›´æ¥æ¨¡å‹ (ç»†èŠ‚)</h3>
                        <p class="text-xs text-gray-500 mb-4">ç›´æ¥è¿æ¥å„ LLM æä¾›å•†çš„ API</p>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div v-for="(provider, name) in directProviders" :key="name" class="bg-black/30 rounded-lg p-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-medium">{{ provider.name }}</span>
                                    <span :class="provider.configured ? 'text-green-400' : 'text-gray-500'" class="text-xs">
                                        {{ provider.configured ? 'å·²é…ç½®' : 'æœªé…ç½®' }}
                                    </span>
                                </div>
                                <input v-model="provider.apiKey" type="password" :placeholder="'API Key'"
                                       class="galaxy-input w-full rounded px-2 py-1 text-xs outline-none mb-2">
                                <button @click="saveProvider(name, provider.apiKey)" 
                                        class="w-full py-1 rounded text-xs bg-purple-600 hover:bg-purple-500">
                                    ä¿å­˜
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æµ‹è¯• LLM -->
                    <div class="status-card rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3">ğŸ§ª æµ‹è¯• LLM</h3>
                        <div class="flex space-x-3">
                            <input v-model="testMessage" type="text" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯..."
                                   class="galaxy-input flex-1 rounded-lg px-3 py-2 text-sm outline-none">
                            <button @click="testLLM" class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 text-sm">
                                æµ‹è¯•
                            </button>
                        </div>
                        <div v-if="testResult" class="mt-3 p-3 bg-black/30 rounded-lg text-sm">
                            <div class="text-xs text-gray-500 mb-1">ç»“æœ:</div>
                            <pre class="whitespace-pre-wrap">{{ testResult }}</pre>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- èŠ‚ç‚¹é¡µé¢ -->
            <div v-show="currentTab === 'nodes'" class="h-full overflow-auto p-6">
                <div class="max-w-4xl mx-auto">
                    <div class="status-card rounded-xl p-4 mb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">ğŸŒ èŠ‚ç‚¹çŠ¶æ€</h3>
                            <button @click="checkNodes" class="px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-sm">
                                æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-2">
                            <div v-for="node in nodes" :key="node.node_id" 
                                 class="bg-black/30 rounded-lg p-2 text-center cursor-pointer hover:bg-black/50 transition-all">
                                <div class="text-xs font-mono text-gray-500">{{ node.node_id }}</div>
                                <div class="text-sm truncate">{{ node.name }}</div>
                                <div class="text-xs" :class="node.status === 'healthy' ? 'text-green-400' : 'text-gray-500'">
                                    {{ node.status || 'æœªçŸ¥' }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
    </div>
    
    <script>
        const { createApp, ref, onMounted, computed } = Vue;
        
        createApp({
            setup() {
                const currentTab = ref('config');
                const messages = ref([]);
                const inputMessage = ref('');
                const isLoading = ref(false);
                const currentTime = ref('');
                const chatContainer = ref(null);
                const starsContainer = ref(null);
                
                // é…ç½®ç›¸å…³
                const configStatus = ref({});
                const oneapiUrl = ref('http://localhost:8001/v1');
                const oneapiKey = ref('');
                const directProviders = ref({
                    openai: { name: 'OpenAI', apiKey: '', configured: false },
                    anthropic: { name: 'Anthropic', apiKey: '', configured: false },
                    deepseek: { name: 'DeepSeek', apiKey: '', configured: false },
                    zhipu: { name: 'æ™ºè°± AI', apiKey: '', configured: false },
                    groq: { name: 'Groq', apiKey: '', configured: false },
                    openrouter: { name: 'OpenRouter', apiKey: '', configured: false }
                });
                
                const testMessage = ref('Hello, this is a test.');
                const testResult = ref('');
                const nodes = ref([]);
                
                // ç”Ÿæˆæ˜Ÿæ˜Ÿ
                const generateStars = () => {
                    if (!starsContainer.value) return;
                    for (let i = 0; i < 100; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.style.left = Math.random() * 100 + '%';
                        star.style.top = Math.random() * 100 + '%';
                        star.style.width = Math.random() * 2 + 1 + 'px';
                        star.style.height = star.style.width;
                        star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                        star.style.setProperty('--opacity', Math.random() * 0.5 + 0.3);
                        starsContainer.value.appendChild(star);
                    }
                };
                
                const updateTime = () => {
                    currentTime.value = new Date().toLocaleTimeString('zh-CN', { hour12: false });
                };
                
                // åŠ è½½é…ç½®çŠ¶æ€
                const loadConfigStatus = async () => {
                    try {
                        const response = await axios.get('/api/v1/config/status');
                        configStatus.value = response.data;
                    } catch (error) {
                        console.error('Failed to load config status:', error);
                    }
                };
                
                // åŠ è½½èŠ‚ç‚¹
                const loadNodes = async () => {
                    try {
                        const response = await axios.get('/api/v1/config/nodes');
                        nodes.value = response.data.nodes || [];
                    } catch (error) {
                        console.error('Failed to load nodes:', error);
                    }
                };
                
                // ä¿å­˜ OneAPI é…ç½®
                const saveOneAPI = async () => {
                    try {
                        await axios.post('/api/v1/config/api-key', { provider: 'oneapi', api_key: oneapiKey.value });
                        alert('OneAPI é…ç½®å·²ä¿å­˜');
                        loadConfigStatus();
                    } catch (error) {
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    }
                };
                
                // ä¿å­˜æä¾›å•†é…ç½®
                const saveProvider = async (name, apiKey) => {
                    try {
                        await axios.post('/api/v1/config/api-key', { provider: name, api_key: apiKey });
                        directProviders.value[name].configured = true;
                        alert(name + ' é…ç½®å·²ä¿å­˜');
                        loadConfigStatus();
                    } catch (error) {
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    }
                };
                
                // æµ‹è¯• LLM
                const testLLM = async () => {
                    testResult.value = 'æµ‹è¯•ä¸­...';
                    try {
                        const response = await axios.post('/api/v1/config/test-llm', { message: testMessage.value });
                        testResult.value = JSON.stringify(response.data, null, 2);
                    } catch (error) {
                        testResult.value = 'æµ‹è¯•å¤±è´¥: ' + error.message;
                    }
                };
                
                // æ£€æŸ¥èŠ‚ç‚¹
                const checkNodes = async () => {
                    try {
                        const response = await axios.post('/api/v1/config/nodes/check');
                        const results = response.data.results;
                        nodes.value.forEach(node => {
                            node.status = results[node.node_id]?.success ? 'healthy' : 'unhealthy';
                        });
                    } catch (error) {
                        console.error('Failed to check nodes:', error);
                    }
                };
                
                // å‘é€æ¶ˆæ¯
                const sendMessage = async () => {
                    if (!inputMessage.value.trim() || isLoading.value) return;
                    const message = inputMessage.value.trim();
                    inputMessage.value = '';
                    
                    messages.value.push({ id: Date.now(), role: 'user', content: message, timestamp: new Date() });
                    isLoading.value = true;
                    
                    try {
                        const response = await axios.post('/api/v1/chat', { message });
                        messages.value.push({ id: Date.now() + 1, role: 'assistant', content: response.data.response || 'å¤„ç†å®Œæˆ', timestamp: new Date() });
                    } catch (error) {
                        messages.value.push({ id: Date.now() + 1, role: 'assistant', content: 'âŒ è¿æ¥å¤±è´¥: ' + error.message, timestamp: new Date() });
                    }
                    
                    isLoading.value = false;
                };
                
                const formatTime = (date) => new Date(date).toLocaleTimeString('zh-CN', { hour12: false });
                
                onMounted(() => {
                    generateStars();
                    updateTime();
                    setInterval(updateTime, 1000);
                    loadConfigStatus();
                    loadNodes();
                });
                
                return {
                    currentTab, messages, inputMessage, isLoading, currentTime, chatContainer, starsContainer,
                    configStatus, oneapiUrl, oneapiKey, directProviders, testMessage, testResult, nodes,
                    loadConfigStatus, saveOneAPI, saveProvider, testLLM, checkNodes, sendMessage, formatTime
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
